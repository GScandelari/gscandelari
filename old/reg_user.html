<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Usuários - gscandelari</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>

<body>
    <div id="menu"></div>
    <div class="content">
        <h2>Registro de Usuários</h2>
        <form id="user-form">
            <label for="first-name">Nome:</label>
            <input type="text" id="first-name" name="first-name" required>
            <br>
            <label for="last-name">Sobrenome:</label>
            <input type="text" id="last-name" name="last-name" required>
            <br>
            <label for="email">E-mail:</label>
            <input type="email" id="email" name="email" required>
            <br>
            <label for="password">Senha:</label>
            <input type="password" id="password" name="password" required>
            <br>
            <button type="button" onclick="clearForm()">Limpar</button>
            <button type="button" onclick="saveUser()">Salvar</button>
        </form>
        <h2>Lista de Usuários</h2>
        <div id="user-list">
            <!-- Lista de usuários será adicionada aqui -->
        </div>
    </div>
    <script src="scripts.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
        import { getDatabase, ref, set, get, child, update } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCGAy-FgqttT29D3SGQpejYC1dDc64gD-A",
            authDomain: "gscandelari-8890.firebaseapp.com",
            databaseURL: "https://gscandelari-8890-default-rtdb.firebaseio.com",
            projectId: "gscandelari-8890",
            storageBucket: "gscandelari-8890.appspot.com",
            messagingSenderId: "794313971390",
            appId: "1:794313971390:web:a0f41845e462acc5a970ef",
            measurementId: "G-RD11NKCV3M"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        window.clearForm = function () {
            document.getElementById("user-form").reset();
        };

        window.saveUser = function () {
            const firstName = document.getElementById("first-name").value;
            const lastName = document.getElementById("last-name").value;
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            if (firstName && lastName && email && password) {
                createUserWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        const userId = userCredential.user.uid;
                        set(ref(database, 'users/' + userId), {
                            firstName: firstName,
                            lastName: lastName,
                            email: email,
                            status: "ativo"
                        });
                        addUserToList(userId, firstName, lastName, email, "ativo");
                        clearForm();
                    })
                    .catch((error) => {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                        console.error("Erro ao criar usuário:", errorCode, errorMessage);
                    });
            } else {
                alert("Por favor, preencha todos os campos.");
            }
        };

        function addUserToList(userId, firstName, lastName, email, status) {
            const userList = document.getElementById("user-list");

            const userDiv = document.createElement("div");
            userDiv.className = "user";
            userDiv.id = userId;

            const userInfo = document.createElement("p");
            userInfo.textContent = `${firstName} ${lastName} - ${email}`;
            userDiv.appendChild(userInfo);

            const statusLabel = document.createElement("label");
            statusLabel.className = "switch";

            const statusCheckbox = document.createElement("input");
            statusCheckbox.type = "checkbox";
            statusCheckbox.checked = status === "ativo";
            statusCheckbox.addEventListener("change", function () {
                const newStatus = this.checked ? "ativo" : "inativo";
                update(ref(database, 'users/' + userId), { status: newStatus });
            });

            const statusSlider = document.createElement("span");
            statusSlider.className = "slider";

            statusLabel.appendChild(statusCheckbox);
            statusLabel.appendChild(statusSlider);

            userDiv.appendChild(statusLabel);
            userList.appendChild(userDiv);
        }

        function loadUsers() {
            get(child(ref(database), 'users')).then((snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const userId = childSnapshot.key;
                        const user = childSnapshot.val();
                        addUserToList(userId, user.firstName, user.lastName, user.email, user.status);
                    });
                } else {
                    console.log("No data available");
                }
            }).catch((error) => {
                console.error(error);
            });
        }

        window.addEventListener('load', function () {
            loadUsers();
        });
    </script>
</body>

</html>